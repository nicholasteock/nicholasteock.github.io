"use strict";angular.module("oasApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ngCookies","ui.bootstrap"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/dashboard.html",controller:"DashboardCtrl"}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl"}).when("/dashboard",{templateUrl:"views/dashboard.html",controller:"DashboardCtrl"}).otherwise({redirectTo:"/"})}]).run(["$rootScope","$location","$cookies","Session","USER_ROLES","AuthService",function(a,b,c,d,e,f){a.session=d,a.userRoles=e,a.isAuthenticated=f.isAuthenticated,a.isAuthorized=f.isAuthorized,!a.session.user&&a.isAuthenticated()&&a.session.restoreSession(),a.$on("$locationChangeStart",function(c,d){a.isAuthenticated()||"views/login.html"===d.templateUrl||b.path("/login")}),a.$on("not_authenticated",function(){alert("Please login to continue."),a.session.destroy(),b.path("/login")})}]),angular.module("oasApp").controller("ManpowerCtrl",["$scope",function(a){a.searchEmployee="",a.alphabetList="A",a.currentPanel="attendance",a.isPanel=function(b){return a.currentPanel===b},a.setPanel=function(b){a.currentPanel=b}}]).directive("manpowerTab",function(){return{templateUrl:"views/manpower.html"}}),angular.module("oasApp").controller("ProjectsCtrl",["$scope",function(a){a.currentPanel="profiles"}]).directive("projectsTab",function(){return{templateUrl:"views/projects.html"}}),angular.module("oasApp").controller("LoginCtrl",["$rootScope","$scope","$modal","$location","AUTH_EVENTS","AuthService",function(a,b,c,d,e,f){b.credentials={email:"testing@oaspainting.com",password:"oasadmin123!"},b.login=function(b){console.log("Login function"),f.login(b).then(function(){a.$broadcast(e.loginSuccess),d.path("/dashboard")},function(){alert("Login failed."),a.$broadcast(e.loginFailed)})},b.forgotpassword=function(){var a=c.open({templateUrl:"views/modal/forgotpassword.html",controller:"ForgotpasswordCtrl",backdrop:"static",backdropClass:"backdrop-oas",size:"sm",windowClass:"modal-oas vertical-center forgotpassword-modal"});a.result.then(function(){})},b.generalsettings=function(){var a=c.open({templateUrl:"views/modal/generalsettings.html",controller:"GeneralsettingsCtrl",backdrop:"static",backdropClass:"backdrop-oas",windowClass:"modal-oas generalsettings-modal"});a.result.then(function(){})}}]).directive("login",function(){return{templateUrl:"views/login.html"}}),angular.module("oasApp").controller("DashboardCtrl",["$scope",function(a){a.currentTab="manpower",a.isTab=function(b){return a.currentTab===b},a.setTab=function(b){a.currentTab=b}}]),angular.module("oasApp").controller("ProfilesCtrl",["$scope","ManpowerService",function(a,b){a.viewtype="current",a.newProfile=!1,a.isView=function(b){return b===a.viewtype},a.manpowerService=b,a.manpowerService.profiles=b.profiles,a.manpowerService.profilesArchived=b.profilesArchived,a.manpowerService.getProfiles(a.session.user),a.manpowerService.getProfilesArchived(a.session.user),a.$on("profile_created",function(){a.newProfile=!1,a.manpowerService.getProfiles(a.session.user)}),a.$on("profiles_changed",function(){a.manpowerService.getProfiles(a.session.user),a.manpowerService.getProfilesArchived(a.session.user)})}]).directive("manpowerProfiles",function(){return{templateUrl:"views/profiles.html"}}),angular.module("oasApp").controller("AllocationCtrl",["$scope",function(a){a.viewtype="normal",a.isView=function(b){return b===a.viewtype}}]).directive("manpowerAllocation",function(){return{templateUrl:"views/allocation.html"}}),angular.module("oasApp").controller("SalaryCtrl",["$scope",function(a){a.viewtype="daily",a.salarymode="live",a.date="05 January 2014",a.salary={daily:[{name:"Employee 1",avatarThumb:"",basic:110,skill:4,overtime:4,mealAllowance:4,projectAllowance:4,extra:4,externalWork:4,mc:4,hp:4,safety:4,additional:4,transportAllowance:4,total:3e3},{name:"Employee 2",avatarThumb:"",basic:110,skill:4,overtime:4,mealAllowance:4,projectAllowance:4,extra:4,externalWork:4,mc:4,hp:4,safety:4,additional:4,transportAllowance:4,total:3e3},{name:"Employee 3",avatarThumb:"",basic:110,skill:4,overtime:4,mealAllowance:4,projectAllowance:4,extra:4,externalWork:4,mc:4,hp:4,safety:4,additional:4,transportAllowance:4,total:3e3},{name:"Employee 4",avatarThumb:"",basic:110,skill:4,overtime:4,mealAllowance:4,projectAllowance:4,extra:4,externalWork:4,mc:4,hp:4,safety:4,additional:4,transportAllowance:4,total:3e3},{name:"Employee 5",avatarThumb:"",basic:110,skill:4,overtime:4,mealAllowance:4,projectAllowance:4,extra:4,externalWork:4,mc:4,hp:4,safety:4,additional:4,transportAllowance:4,total:3e3},{name:"Employee 6",avatarThumb:"",basic:110,skill:4,overtime:4,mealAllowance:4,projectAllowance:4,extra:4,externalWork:4,mc:4,hp:4,safety:4,additional:4,transportAllowance:4,total:3e3},{name:"Employee 7",avatarThumb:"",basic:110,skill:4,overtime:4,mealAllowance:4,projectAllowance:4,extra:4,externalWork:4,mc:4,hp:4,safety:4,additional:4,transportAllowance:4,total:3e3}],monthly:[{name:"Employee 1",avatarThumb:"",basic:110,skill:4,overtime:4,mealAllowance:4,projectAllowance:4,extra:4,externalWork:4,mc:4,hp:4,safety:4,additional:4,transportAllowance:4,total:3e3},{name:"Employee 2",avatarThumb:"",basic:110,skill:4,overtime:4,mealAllowance:4,projectAllowance:4,extra:4,externalWork:4,mc:4,hp:4,safety:4,additional:4,transportAllowance:4,total:3e3},{name:"Employee 3",avatarThumb:"",basic:110,skill:4,overtime:4,mealAllowance:4,projectAllowance:4,extra:4,externalWork:4,mc:4,hp:4,safety:4,additional:4,transportAllowance:4,total:3e3}]},a.isView=function(b){return b===a.viewtype}}]).directive("manpowerSalary",function(){return{templateUrl:"views/salary.html"}}),angular.module("oasApp").controller("AttendanceCtrl",["$rootScope","$scope","AttendanceService","SettingsService","ProjectsService",function(a,b,c,d,e){b.settingsService=d,b.settingsService.settings=d.settings,b.$on("settings_changed",function(){b.settingsService.getSettings(b.session.user)}),b.$on("settings_updated",function(){console.log("settings_updated"),a.$broadcast("update_attendance")}),b.projectsService=e,b.projectsService.projects=e.projects,b.projectsService.getProjects(b.session.user),b.$on("projects_changed",function(){b.projectsService.getProjects(b.session.user)}),b.$on("project_selected_changed",function(){}),b.attendanceDate="",b.attendanceService=c,b.attendanceService.attendances=c.attendances,b.$on("update_attendance",function(){void 0!==b.settingsService.settings.work_start_at&&b.attendanceService.getAttendances(b.attendanceDate,b.settingsService.settings.work_start_at,b.session.user)}),b.$watch("attendanceDate",function(b,c){if(console.log("attendanceDate changed : ",b,c),""===b)return void(b=c);if("object"==typeof b){console.log("asdfas",b);var d=new Date(b),e=d.getDate(),f=d.getMonth()+1,g=d.getFullYear();10>f&&(f="0"+f),10>e&&(e="0"+e),b=g+"-"+f+"-"+e}a.$broadcast("update_attendance")});var f=new Date,g=f.getDate(),h=f.getMonth()+1,i=f.getFullYear();10>h&&(h="0"+h),10>g&&(g="0"+g),b.attendanceDate=i+"-"+h+"-"+g,b.selectedProject="All projects",b.chooseProject=function(c){b.selectedProject!==c&&a.$broadcast("project_selected_changed"),b.selectedProject=c},b.datepickers={attendanceDate:!1},b.dateOptions={showWeeks:!1,startingDay:0,formatDay:"dd",formatMonth:"MMMM",formatYear:"yy",minDate:"2014-01-01"},b.open=function(a){console.log(b.settingsService.settings),a.preventDefault(),a.stopPropagation();var c={attendanceDate:!1};angular.copy(c,b.datepickers),b.datepickers[a.target.name]=!0},b.shiftDay=function(a){var c,d,e,f=typeof b.attendanceDate,g=b.attendanceDate,h=new Date(g);if("string"===f){var i=g.split("-");e=parseInt(i[0]),d=parseInt(i[1])-1,c=parseInt(i[2]),h=new Date(e,d,c)}h.setDate(h.getDate()+a),c=h.getDate(),d=h.getMonth()+1,e=h.getFullYear(),10>d&&(d="0"+d),10>c&&(c="0"+c),b.attendanceDate=e+"-"+d+"-"+c}}]).directive("manpowerAttendance",function(){return{templateUrl:"views/attendance.html"}}),angular.module("oasApp").controller("SettingsCtrl",["$scope",function(a){a.currentPanel="general",a.isPanel=function(b){return a.currentPanel===b},a.setPanel=function(b){a.currentPanel=b}}]).directive("settingsTab",function(){return{templateUrl:"views/settings.html"}}),angular.module("oasApp").controller("GeneralsettingsCtrl",["$rootScope","$scope","SettingsService",function(a,b,c){b.settingsService=c,b.settingsService.settings=c.settings,a.$broadcast("settings_changed"),b.$on("settings_changed",function(){b.settingsService.getSettings(b.session.user)}),b.save=function(){console.log("Updating settings"),b.settingsService.updateSettings(b.settingsService.settings,b.session.user).then(function(b){if(console.log("update settings done",b),"success"===b.result)return void a.$broadcast("settings_changed");switch(b.status){case 422:console.error("422: ",b.data),alert(b.data.join("\n"));break;case 401:a.$broadcast("not_authenticated")}})}}]).directive("settingsGeneral",function(){return{templateUrl:"views/generalsettings.html"}}),angular.module("oasApp").constant("AUTH_EVENTS",{loginSuccess:"auth-login-success",loginFailed:"auth-login-failed",logoutSuccess:"auth-logout-success",sessionTimeout:"auth-session-timeout",notAuthenticated:"auth-not-authenticated",notAuthorized:"auth-not-authorized"}),angular.module("oasApp").constant("USER_ROLES",{all:"*",admin:"admin",user:"user"}),angular.module("oasApp").factory("AuthService",["$http","$cookies","Session","HTTP_PARAMS",function(a,b,c,d){var e={};return e.login=function(b){return console.log("In authservice login"),a({method:"POST",url:d.urlPrefix+"sessions",headers:{"X-APP-SECRET":d.appSecret},params:{email:b.email,password:b.password}}).then(function(a){return console.log("res data: ",a.data),c.create(a.data),a.data})},e.userInfo=function(b,c){return console.log("In authservice userinfo"),a({method:"GET",url:d.urlPrefix+"sessions",headers:{"X-USER-ID":b,"X-USER-TOKEN":c}}).then(function(a){return a.data})},e.isAuthenticated=function(){return!!b.authToken},e.isAuthorized=function(a){return angular.isArray(a)||(a=[a]),e.isAuthenticated()&&-1!==a.indexOf(c.userRole)},e}]),angular.module("oasApp").factory("ManpowerService",["$http","AuthService","HTTP_PARAMS",function(a,b,c){var d=function(a){var b={};return b.result="success",b.data=a.data,b},e=function(a){var b={};return b.result="failure",b.status=a.status,b.data=a.data.errors,b},f={};return f.profiles=[],f.profilesArchived=[],f.getProfiles=function(d){return console.log("In manpowerService profiles"),void 0===d&&b.retrieveSession(),a({method:"GET",url:c.urlPrefix+"employees",headers:{"X-USER-ID":d.id,"X-USER-TOKEN":d.authToken},params:{page:1}}).then(function(a){angular.copy(a.data.employees,f.profiles)})},f.getProfilesArchived=function(b){return console.log("In manpowerService getProfilesArchived"),a({method:"GET",url:c.urlPrefix+"employees/archives",headers:{"X-USER-ID":b.id,"X-USER-TOKEN":b.authToken},params:{page:1}}).then(function(a){angular.copy(a.data.employees,f.profilesArchived)})},f.createProfile=function(b,f){var g=JSON.parse(angular.toJson(b));return console.log("In manpowerService.createProfile",b),a({method:"POST",url:c.urlPrefix+"employees/",headers:{"X-USER-ID":f.id,"X-USER-TOKEN":f.authToken},params:g}).then(d,e)},f.updateProfile=function(b,f){console.log("In manpowerService.updateProfile",b);var g=JSON.parse(angular.toJson(b));return a({method:"PUT",url:c.urlPrefix+"employees/"+b.id,headers:{"X-USER-ID":f.id,"X-USER-TOKEN":f.authToken},params:g}).then(d,e)},f.archiveProfile=function(b,f){return console.log("In manpowerService.archiveProfile"),a({method:"POST",url:c.urlPrefix+"employees/"+b+"/archive",headers:{"X-USER-ID":f.id,"X-USER-TOKEN":f.authToken}}).then(d,e)},f.unarchiveProfile=function(b,f){return console.log("In manpowerService.unarchiveProfile"),a({method:"POST",url:c.urlPrefix+"employees/"+b+"/unarchive",headers:{"X-USER-ID":f.id,"X-USER-TOKEN":f.authToken}}).then(d,e)},f.deleteProfile=function(b,f){return console.log("In manpowerService.deleteProfile"),a({method:"DELETE",url:c.urlPrefix+"employees/"+b,headers:{"X-USER-ID":f.id,"X-USER-TOKEN":f.authToken}}).then(d,e)},f}]),angular.module("oasApp").factory("SettingsService",["$rootScope","$http","AuthService","HTTP_PARAMS",function(a,b,c,d){var e=function(a){var b={};return b.result="success",b.data=a.data,b},f=function(a){var b={};return b.result="failure",b.status=a.status,b.data=a.data.errors,b},g=function(a){var b=["00:00","01:00","02:00","03:00","04:00","05:00","06:00","07:00","08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00","22:00","23:00"],c=a.work_start_at,d=Number(c[0]+c[1]),e=b.slice(0,d),f=b.slice(d),g=f.concat(e);a.timelineArr=g.concat([c]),angular.copy(a,h.settings)},h={};return h.settings={},h.getSettings=function(e){return console.log("In settingsService.getSettings"),void 0===e&&c.retrieveSession(),b({method:"GET",url:d.urlPrefix+"settings",headers:{"X-USER-ID":e.id,"X-USER-TOKEN":e.authToken}}).then(function(b){g(b.data),a.$broadcast("settings_updated")})},h.updateSettings=function(a,g){return console.log("In settingsService.updateSettings"),void 0===g&&c.retrieveSession(),b({method:"POST",url:d.urlPrefix+"settings",headers:{"X-USER-ID":g.id,"X-USER-TOKEN":g.authToken},params:a}).then(e,f)},h}]),angular.module("oasApp").controller("PersonalsettingsCtrl",["$scope",function(a){a.name="Employee Name",a.position="Employee Position",a.email="Employee@oas.com",a.password="1234",a.newpassword="",a.confirmpassword=""}]).directive("settingsPersonal",function(){return{templateUrl:"views/personalsettings.html"}}),angular.module("oasApp").controller("AccountsettingsCtrl",["$scope",function(a){a.accounts=[{name:"Employee Name 1",position:"Position 1",email:"1@oas.com",password:"123456",mobilename:"Employee Name",mobilepassword:"123456"},{name:"Employee Name 2",position:"Position 2",email:"2@oas.com",password:"123456",mobilename:"Employee Name",mobilepassword:"123456"},{name:"Employee Name 3",position:"Position 3",email:"3@oas.com",password:"123456",mobilename:"Employee Name",mobilepassword:"123456"}]}]).directive("settingsAccounts",function(){return{templateUrl:"views/accountsettings.html"}}),angular.module("oasApp").controller("ForgotpasswordCtrl",["$scope","$modalInstance",function(a,b){a.email="",a.ok=function(){b.close("")},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("oasApp").controller("GeneralsettingsmodalCtrl",["$rootScope","$scope","$modalInstance","SettingsService",function(a,b,c,d){b.settingsService=d,b.settingsService.settings=d.settings,b.settingsService.getSettings(b.session.user),b.save=function(){console.log("Updating settings"),b.settingsService.updateSettings(b.settingsService.settings,b.session.user).then(function(b){if(console.log("update settings done",b),"success"===b.result)return a.$broadcast("settings_changed"),void c.close("");switch(b.status){case 422:console.error("422: ",b.data),alert(b.data.join("\n"));break;case 401:a.$broadcast("not_authenticated")}})},b.cancel=function(){c.dismiss("cancel")}}]),angular.module("oasApp").controller("DeleteconfirmationCtrl",["$scope","$modalInstance",function(a,b){a.response=!1,a.confirm=function(){b.close(!0)},a.cancel=function(){b.dismiss("cancel")}}]).directive("deleteconfirmation",function(){return{templateUrl:"views/modal/deleteconfirmation.html"}}),angular.module("oasApp").directive("matchwith",function(){return{require:"ngModel",scope:{otherValue:"=matchwith"},link:function(a,b,c,d){d.$validators.matchwith=function(b){return b==a.otherValue.$viewValue},a.$watch(a.otherValue,function(){d.$validate()})}}}),angular.module("oasApp").controller("AccountcardCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]).directive("accountCard",function(){return{templateUrl:"views/accountcard.html"}}),angular.module("oasApp").controller("ProfilecardCtrl",["$rootScope","$scope","$modal",function(a,b,c){var d=function(a){if(null==a)return null;var b=new Date(a),c=b.getDate(),d=b.getMonth()+1,e=b.getFullYear();return 10>d&&(d="0"+d),10>c&&(c="0"+c),e+"-"+d+"-"+c},e=function(a){var b=!0,c=["login_id","password","others","additional_qualification","soc_expired_at","soc_details","skill_passed","passed_date","avatar_medium_url","employee_files"],d=JSON.parse(angular.toJson(a));return null==d.position||"SUPERVISOR"!==d.position.toUpperCase()||""!==d.login_id&&""!==d.password?(angular.forEach(d,function(a,d){(null==a||""===a)&&-1===c.indexOf(d)&&(console.error("Incomplete field ",d),b=!1)}),b):(console.error("Supervisor needs login_id and password."),b=!1)};b.editMode=!1,b.datepickers={birthDate:!1,joinDate:!1,applicationDate:!1,wpexpiryDate:!1,passportexpiryDate:!1,commenceDate:!1},b.open=function(a){a.preventDefault(),a.stopPropagation();var c={birthDate:!1,joinDate:!1,applicationDate:!1,wpexpiryDate:!1,passportexpiryDate:!1,commenceDate:!1};angular.copy(c,b.datepickers),b.datepickers[a.target.name]=!0},b.dateOptions={showWeeks:!1,startingDay:0,formatDay:"dd",formatMonth:"MMMM",formatYear:"yy",minDate:"2014-01-01"},b.testing=function(){var a=c.open({templateUrl:"views/modal/generalsettingsmodal.html",controller:"GeneralsettingsmodalCtrl",backdrop:"static",backdropClass:"backdrop-oas",windowClass:"modal-oas vertical-center generalsettings-modal"});a.result.then(function(){})},b.deleteConfirmation=function(d){var e=c.open({templateUrl:"views/modal/deleteconfirmation.html",controller:"DeleteconfirmationCtrl",backdrop:"static",backdropClass:"backdrop-oas",size:"sm",windowClass:"modal-oas vertical-center deleteconfirmation-modal"});e.result.then(function(c){c&&b.manpowerService.deleteProfile(d,b.session.user).then(function(){a.$broadcast("profiles_changed")})})},b.toggleEdit=function(){b.editMode=!b.editMode},b.saveChanges=function(c){if(e(c)===!1)return void console.error("form invalid");var f=c;f.login_id=null,f.date_of_birth=d(c.date_of_birth),f.joined_date=d(c.joined_date),f.application_date=d(c.application_date),f.wp_expired_at=d(c.wp_expired_at),f.passport_expired_at=d(c.passport_expired_at),f.commence_date=d(c.commence_date),b.manpowerService.updateProfile(f,b.session.user).then(function(c){if(console.log("update profile done",c),"success"===c.result)return b.toggleEdit(),void a.$broadcast("profiles_changed");switch(c.status){case 422:console.error("422: ",c.data),alert(c.data.join("\n"));break;case 401:a.$broadcast("not_authenticated")}})},b.archive=function(c){console.log("archiving employee with id : ",c),b.manpowerService.archiveProfile(c,b.session.user).then(function(b){if(console.log("archive profile done",b),"success"===b.result)return void a.$broadcast("profiles_changed");switch(b.status){case 422:console.error("422: ",b.data),alert(b.data.join("\n"));break;case 401:a.$broadcast("not_authenticated")}})},b.unarchive=function(c){console.log("unarchiving employee with id : ",c),b.manpowerService.unarchiveProfile(c,b.session.user).then(function(b){if(console.log("unarchive profile done",b),"success"===b.result)return void a.$broadcast("profiles_changed");switch(b.status){case 422:console.error("422: ",b.data),alert(b.data.join("\n"));break;case 401:a.$broadcast("not_authenticated")}})}}]).directive("profileCard",function(){return{templateUrl:"views/profilecard.html"}}),angular.module("oasApp").constant("HTTP_PARAMS",{urlPrefix:"http://54.169.2.173/v1/",appSecret:"992bb2ecb4aca0986c898f19801731d1297220bb857961a0bd2661d5d327c4a2"}),angular.module("oasApp").factory("Session",["$cookies",function(a){return this.create=function(b){this.user={id:b.id,name:b.name,avatar:b.avatar_medium_url,avatarThumb:b.avatar_thumb_url,authToken:b.authentication_token},a.user=angular.toJson(this.user),a.authToken=b.authentication_token},this.destroy=function(){this.user=null,a.userId=null,a.authToken=null},this.restoreSession=function(){this.user=angular.fromJson(a.user)},this}]),angular.module("oasApp").controller("SalarycarddailyCtrl",["$scope",function(a){a.editMode=!1,a.toggleEdit=function(){a.editMode=!a.editMode}}]).directive("salaryCardDaily",function(){return{templateUrl:"views/salarycarddaily.html"}}),angular.module("oasApp").controller("SalarycardmonthlyCtrl",["$scope",function(a){a.editMode=!1,a.toggleEdit=function(){a.editMode=!a.editMode}}]).directive("salaryCardMonthly",function(){return{templateUrl:"views/salarycardmonthly.html"}}),angular.module("oasApp").controller("alphabetListCtrl",["$scope",function(a){a.active="A"}]).directive("alphabetList",function(){return{templateUrl:"views/alphabetlist.html",restrict:"EA"}}),angular.module("oasApp").filter("nulldash",function(){return function(a){return null==a?"-":a}}),angular.module("oasApp").controller("NewprofileCtrl",["$rootScope","$scope",function(a,b){var c=function(a){if(null==a)return null;var b=new Date(a),c=b.getDate(),d=b.getMonth()+1,e=b.getFullYear();return 10>d&&(d="0"+d),10>c&&(c="0"+c),e+"-"+d+"-"+c},d=function(a){var b=!0,c=["login_id","password","others","additional_qualification","soc_expired_at","soc_details","skill_passed","passed_date","avatar_medium_url","employee_files"],d=JSON.parse(angular.toJson(a));return null==d.position||"SUPERVISOR"!==d.position.toUpperCase()||""!==d.login_id&&""!==d.password?(angular.forEach(d,function(a,d){(null==a||""===a)&&-1===c.indexOf(d)&&(console.error("Incomplete field ",d),b=!1)}),b):(console.error("Supervisor needs login_id and password."),b=!1)},e=function(){b.newEmployee={name:"New Employee",avatar_medium_url:null,login_id:null,passcode:null,dormitory_address:null,nationality:null,foreign:null,date_of_birth:null,position:null,joined_date:null,work_permit_number:null,application_date:null,commence_date:null,employment_period:null,fin:null,wp_expired_at:null,passport:null,passport_expired_at:null,skill_passed:null,passed_date:null,soc_details:null,soc_expired_at:null,additional_qualification:null,others:null,basic_rate:null,skill_rate:null,overtime_rate:null,levy_rate:null,meal_allowance:null,employee_files:null}};b.$watch("newProfile",function(){e()}),b.datepickers={birthDate:!1,joinDate:!1,applicationDate:!1,wpexpiryDate:!1,passportexpiryDate:!1,commenceDate:!1},b.dateOptions={showWeeks:!1,startingDay:0,formatDay:"dd",formatMonth:"MMMM",formatYear:"yy",minDate:"2014-01-01"},b.open=function(a){a.preventDefault(),a.stopPropagation();var c={birthDate:!1,joinDate:!1,applicationDate:!1,wpexpiryDate:!1,passportexpiryDate:!1,commenceDate:!1};angular.copy(c,b.datepickers),b.datepickers[a.target.name]=!0},b.createEmployee=function(f){if(d(f)===!1)return void console.error("form invalid");var g=f;g.date_of_birth=c(f.date_of_birth),g.joined_date=c(f.joined_date),g.application_date=c(f.application_date),g.wp_expired_at=c(f.wp_expired_at),g.passport_expired_at=c(f.passport_expired_at),g.commence_date=c(f.commence_date),b.manpowerService.createProfile(g,b.session.user).then(function(b){if(console.log("create profile done",b),"success"===b.result)return e(),void a.$broadcast("profile_created");switch(b.status){case 422:console.error("422: ",b.data),alert(b.data.join("\n"));break;case 401:a.$broadcast("not_authenticated")}})}}]).directive("newprofileCard",function(){return{templateUrl:"views/newprofilecard.html"}}),angular.module("oasApp").filter("isforeigner",function(){return function(a){return 1===a?"Foreigner":"Local"}}),angular.module("oasApp").factory("AttendanceService",["$http","AuthService","HTTP_PARAMS",function(a,b,c){var d=function(a){var b={};return b.result="success",b.data=a.data,b},e=function(a){var b={};return b.result="failure",b.status=a.status,b.data=a.data.errors,b},f=function(a,b){console.log("formCheckoutArray : ",b);var c,d,e,f=Number(b.slice(0,2)),g=Number(b.slice(3,5)),h=60*(60*f+g)*1e3,i=a.map(function(a){return 2!==a.type_code&&3!==a.type_code&&4!==a.type_code?null===a.check_out_time?void(a.type_code=0):(c=Number(a.check_out_time.slice(11,13)),d=Number(a.check_out_time.slice(14,16)),e=60*(60*c+d)*1e3):void 0});return i.unshift(h),i.sort(function(a,b){return a-b}),i},g=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n=0;switch(a.type_code){case 1:for(g=Number(a.check_out_time.slice(11,13)),h=Number(a.check_out_time.slice(14,16)),i=60*(60*g+h)*1e3,d=Number(a.check_in_time.slice(11,13)),e=Number(a.check_in_time.slice(14,16)),f=60*(60*d+e)*1e3,j=(i-f)/864e3,j+="%",n=b.length;n>0;)n--,b[n]<=f&&(k=(f-b[n])/864e3,k+="%",n=0);m="attendance-entry blue-bar";break;case 2:j="100%",k="0",m="attendance-entry green-bar";break;case 3:j="100%",k="0",m="attendance-entry green-bar";break;case 4:j="100%",k="0",m="attendance-entry purple-bar";break;default:for(d=Number(a.check_in_time.slice(11,13)),e=Number(a.check_in_time.slice(14,16)),f=60*(60*d+e)*1e3,c=864e5-f+b[0],j=c/864e3,j+="%",n=b.length;n>0;)n--,b[n]<=f&&(k=(f-b[n])/864e3,k+="%",n=0);m="attendance-entry red-bar"}return l=(f-b[0])/86400,l+="%",{entryWidth:j,leftMargin:k,wallMargin:l,classes:m}},h=function(a,b){a.map(function(a){var c=a.attendances,d=f(c,b);return c.map(function(a){return a.styles=g(a,d),a}),a.checkoutArr=d,a}),console.error("data : ",a),angular.copy(a,i.attendances)},i={attendances:[]};return i.getAttendances=function(d,e,f){return console.log("In attendanceService.getAttendances",d,e),void 0===f&&b.retrieveSession(),a({method:"GET",url:c.urlPrefix+"attendances/"+d+"/?page=1",headers:{"X-USER-ID":f.id,"X-USER-TOKEN":f.authToken},params:{page:1}}).then(function(a){h(a.data.employees,e)})},i.createAttendance=function(f,g,h){return console.log("In attendanceService.createAttendance"),void 0===h&&b.retrieveSession(),a({method:"POST",url:c.urlPrefix+"employees/"+g+"/attendances",headers:{"X-USER-ID":h.id,"X-USER-TOKEN":h.authToken},params:f}).then(d,e)},i.updateAttendance=function(b,f){return console.log("In attendanceService.updateAttendance"),a({method:"PUT",url:c.urlPrefix+"attendances/"+b.id,headers:{"X-USER-ID":f.id,"X-USER-TOKEN":f.authToken},params:b}).then(d,e)},i.deleteAttendance=function(b,f){return console.log("In attendanceService.deleteAttendance"),a({method:"DELETE",url:c.urlPrefix+"attendances/"+b,headers:{"X-USER-ID":f.id,"X-USER-TOKEN":f.authToken}}).then(d,e)},i.getEmployeeAttendance=function(f,g){return console.log("In attendanceService getEmployeeAttendance"),void 0===g&&b.retrieveSession(),a({method:"GET",url:c.urlPrefix+"employees/"+f+"/attendances",headers:{"X-USER-ID":g.id,"X-USER-TOKEN":g.authToken},params:{page:1}}).then(d,e)},i}]),angular.module("oasApp").controller("AttendancecardCtrl",["$rootScope","$scope","$modal",function(a,b,c){b.entries=b.employee.attendances.reverse(),b.createEntry=function(){var a=c.open({templateUrl:"views/modal/createentry.html",controller:"CreateentryCtrl",backdrop:"static",backdropClass:"backdrop-oas",windowClass:"modal-oas vertical-center createentry-modal",resolve:{modalInfo:function(){return{newEntryDate:b.attendanceDate,employeeId:b.employee.id,projects:b.projectsService.projects}}}});a.result.then(function(a){b.confirmCreateEntry(a)})},b.confirmCreateEntry=function(d){var e=c.open({templateUrl:"views/modal/createentryconfirmation.html",controller:"CreateentryconfirmationCtrl",backdrop:"static",backdropClass:"backdrop-oas",size:"sm",windowClass:"modal-oas vertical-center createentryconfirmation-modal",resolve:{modalInfo:function(){return{type:d.type_code,name:b.employee.name,avatar:b.employee.avatar_thumb_url}}}});e.result.then(function(c){c&&b.attendanceService.createAttendance(d,d.employeeId,b.session.user).then(function(b){if(console.log("create attendance done",b),"success"===b.result)return console.log("Success response : ",b),void a.$broadcast("update_attendance");switch(b.status){case 422:console.error("422: ",b.data),alert(b.data.join("\n"));break;case 401:a.$broadcast("not_authenticated")}})})}}]).directive("attendanceCard",function(){return{templateUrl:"views/attendancecard.html"}}),angular.module("oasApp").controller("AttendanceentryCtrl",["$scope",function(){}]).directive("attendanceEntry",function(){return{templateUrl:"views/attendanceentry.html"}}),angular.module("oasApp").controller("CreateentryCtrl",["$rootScope","$scope","$filter","$modalInstance","modalInfo",function(a,b,c,d,e){b.ok=function(){var a=b.selectedEntryType+1,c=b.entryRemarks,f=b.selectedProjectId,g=b.checkinTime,h=b.checkoutTime,i=new Date(e.newEntryDate),j={};if(b.errorMessage="",""===a||""===f)return void(b.errorMessage="All fields are required.");if(1===a&&(""===g||""===h))return void(b.errorMessage="All fields are required.");if(j.project_id=f,j.type_code=a,j.employeeId=e.employeeId,1===a){var k=g.split(":"),l=h.split(":"),m=i.setHours(Number(k[0]),Number(k[1]),0,0),n=i.setHours(Number(l[0]),Number(l[1]),0,0),o=new Date(m),p=new Date(n);j.check_in_time=o.toISOString(),j.check_out_time=p.toISOString()}(2===a||3===a||4===a)&&(j.check_in_time=i.toISOString(),j.remark=c),console.log("newEntryParams : ",j),d.close(j)},b.cancel=function(){d.dismiss("cancel")},b.isSelectedEntryType=function(a){switch(a){case"leave":return 1===b.selectedEntryType;case"project":return 0===b.selectedEntryType;default:return!1}},b.newEntryTypes=["PROJECT","LEAVE","MEDICAL LEAVE","PUBLIC HOLIDAY"],b.projects=e.projects,b.selectedEntryType="",b.selectedProjectId="",b.selectedProjectName="",b.selectedProjectAddress="",b.entryRemarks="",b.errorMessage="",b.chooseEntryType=function(a){b.selectedEntryType=b.newEntryTypes.indexOf(a)},b.chooseProject=function(a){var d={};b.selectedProjectId=a,d=c("filter")(b.projects,{id:a})[0],b.selectedProjectName=d.name,b.selectedProjectAddress=d.address},b.status={isopen:!1},b.toggleDropdown=function(a){a.preventDefault(),a.stopPropagation(),b.status.isopen=!b.status.isopen}}]),angular.module("oasApp").factory("ProjectsService",["$http","AuthService","HTTP_PARAMS",function(a,b,c){var d={};return d.projects={},d.getProjects=function(e){return console.log("In projectsService.getProjects"),void 0===e&&b.retrieveSession(),a({method:"GET",url:c.urlPrefix+"projects",headers:{"X-USER-ID":e.id,"X-USER-TOKEN":e.authToken}}).then(function(a){angular.copy(a.data,d)})},d}]),angular.module("oasApp").controller("CreateentryconfirmationCtrl",["$scope","$modalInstance","modalInfo",function(a,b,c){a.modalInfo=c,a.isEntryType=function(a){return c.type===a},a.confirm=function(){b.close(!0)},a.cancel=function(){b.dismiss("cancel")}}]).directive("createentryconfirmation",function(){return{templateUrl:"views/modal/createentryconfirmation.html"}});