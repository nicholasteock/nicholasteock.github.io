"use strict";angular.module("oasApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ngCookies","ui.bootstrap","angularFileUpload"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/dashboard.html",controller:"DashboardCtrl"}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl"}).when("/dashboard",{templateUrl:"views/dashboard.html",controller:"DashboardCtrl"}).otherwise({redirectTo:"/"})}]).run(["$rootScope","$location","$cookies","Session","USER_ROLES","AuthService",function(a,b,c,d,e,f){a.session=d,a.session.user=d.user,a.isAuthenticated=f.isAuthenticated,c.authToken&&a.session.restoreSession(),a.$on("$locationChangeStart",function(c,d){a.isAuthenticated()||"views/login.html"===d.templateUrl||(a.session.destroy(),b.path("/login"))}),a.$on("not_authenticated",function(){alert("Please login to continue."),a.session.destroy(),b.path("/login")})}]),angular.module("oasApp").controller("ManpowerCtrl",["$rootScope","$scope",function(a,b){var c=new Date,d=c.getDate(),e=c.getMonth()+1,f=c.getFullYear();10>e&&(e="0"+e),10>d&&(d="0"+d),b.today=f+"-"+e+"-"+d,b.activeTab="profiles",b.$watch("activeTab",function(b,c){if(console.log("activeTab changed detected :",b),c!==b)switch(b){case"profiles":a.$broadcast("update_profiles");break;case"attendance":a.$broadcast("update_attendance");break;case"salary":a.$broadcast("update_salary");break;case"allocation":a.$broadcast("update_allocation");break;default:a.$broadcast("update_profiles")}}),a.$broadcast("update_profiles")}]).directive("manpowerTab",function(){return{templateUrl:"views/manpower.html"}}),angular.module("oasApp").controller("ProjectsCtrl",["$scope",function(a){a.currentPanel="profiles"}]).directive("projectsTab",function(){return{templateUrl:"views/projects.html"}}),angular.module("oasApp").controller("LoginCtrl",["$rootScope","$scope","$modal","$timeout","$location","AUTH_EVENTS","AuthService",function(a,b,c,d,e,f,g){b.credentials={email:"testing@oaspainting.com",password:"oasadmin123!"},b.login=function(c){g.login(c).then(function(c){a.session.create(c),e.path("/dashboard"),b.generalsettings()})},b.forgotpassword=function(){var a=c.open({templateUrl:"views/modal/forgotpassword.html",controller:"ForgotpasswordCtrl",backdrop:"static",backdropClass:"backdrop-oas",size:"sm",windowClass:"modal-oas vertical-center forgotpassword-modal"});a.result.then(function(){})},b.generalsettings=function(){var a=c.open({templateUrl:"views/modal/generalsettingsmodal.html",controller:"GeneralsettingsmodalCtrl",backdrop:"static",backdropClass:"backdrop-oas",windowClass:"modal-oas generalsettings-modal"});a.result.then(function(){})}}]).directive("login",function(){return{templateUrl:"views/login.html"}}),angular.module("oasApp").controller("DashboardCtrl",["$rootScope","$scope","$location","$modal","ManpowerService","AttendanceService","SalaryService","SettingsService","ProjectsService","AllocationService",function(a,b,c,d){b.session.user=a.session.user,b.activePanel="manpower",b.isEquals=function(a,b){return a===b},b.refreshTab=function(b){switch(b){case"profiles":a.$broadcast("update_profiles");break;case"settings":a.$broadcast("settings_changed");break;case"projects":a.$broadcast("projects_changed");break;case"attendance":a.$broadcast("update_attendance");break;case"salary":a.$broadcast("update_salary")}},b.launchErrorModal=function(a){d.open({templateUrl:"views/modal/errormodal.html",controller:"ErrormodalCtrl",backdrop:"static",backdropClass:"backdrop-oas",windowClass:"modal-oas vertical-center error-modal",resolve:{modalInfo:function(){return{errors:a}}}})},b.logout=function(){console.log("Logout"),b.session.destroy(),c.path("/login")}}]),angular.module("oasApp").controller("ProfilesCtrl",["$rootScope","$scope","$modal","ManpowerService",function(a,b,c,d){b.manpowerService=d,b.manpowerService.profiles=d.profiles,b.manpowerService.profilesArchived=d.profilesArchived,b.manpowerService.getProfiles(b.session.user),b.manpowerService.getProfilesArchived(b.session.user),b.viewtype="current",b.newProfile=!1,b.currentPage=1,b.archivePage=1,b.$on("update_profiles",function(){console.log("update_profiles triggered"),b.newProfile=!1,b.manpowerService.getProfiles(b.session.user),b.manpowerService.getProfilesArchived(b.session.user)}),b.isFirstPage=function(a){return b.isEquals(a,"current")&&1===b.currentPage?!0:b.isEquals(a,"archive")&&1===b.archivePage?!0:!1},b.shiftPage=function(c){b.isEquals(b.viewtype,"current")?(b.currentPage+=c,a.$broadcast("page_changed",{tab:"current_profiles",page:b.currentPage})):(b.archivePage+=c,a.$broadcast("page_changed",{tab:"archived_profiles",page:b.archivePage}))},b.deleteProfileConfirmation=function(d){var e=c.open({templateUrl:"views/modal/deleteconfirmation.html",controller:"DeleteconfirmationCtrl",backdrop:"static",backdropClass:"backdrop-oas",size:"sm",windowClass:"modal-oas vertical-center deleteconfirmation-modal",resolve:{modalInfo:function(){return{type:"profile"}}}});e.result.then(function(c){c&&b.manpowerService.deleteProfile(d,b.session.user).then(function(){a.$broadcast("update_profiles")})})},b.archive=function(c){console.log("archiving employee with id : ",c),b.manpowerService.archiveProfile(c,b.session.user).then(function(c){if(console.log("archive profile done",c),"success"===c.result)return void a.$broadcast("update_profiles");switch(c.status){case 422:console.error("422: ",c.data),b.launchErrorModal(c.data);break;case 401:a.$broadcast("not_authenticated")}})},b.unarchive=function(c){console.log("unarchiving employee with id : ",c),b.manpowerService.unarchiveProfile(c,b.session.user).then(function(c){if(console.log("unarchive profile done",c),"success"===c.result)return void a.$broadcast("update_profiles");switch(c.status){case 422:console.error("422: ",c.data),b.launchErrorModal(c.data);break;case 401:a.$broadcast("not_authenticated")}})}}]).directive("manpowerProfiles",function(){return{templateUrl:"views/profiles.html"}}),angular.module("oasApp").controller("AllocationCtrl",["$rootScope","$scope","AllocationService",function(a,b,c){var d=!1;b.allocationService=c,b.allocationService.allocations=c.allocations,b.$watch("allocationDate",function(b,c){if(d){if(console.log("allocationDate changed : ",b,c),""===b)return void(b=c);if("object"==typeof b){var e=new Date(b),f=e.getDate(),g=e.getMonth()+1,h=e.getFullYear();10>g&&(g="0"+g),10>f&&(f="0"+f),b=h+"-"+g+"-"+f}a.$broadcast("update_allocation")}}),b.$on("update_allocation",function(){console.log("update_allocation triggered"),b.allocationDate||(b.allocationDate=b.today,d=!0),b.allocationService.getNormalAllocations(b.allocationDate,b.session.user),b.allocationService.getOvertimeAllocations(b.allocationDate,b.session.user)}),b.viewtype="normal-allocation",b.datepickers={allocationDate:!1},b.dateOptions={showWeeks:!1,startingDay:0,formatDay:"dd",formatMonth:"MMMM",formatYear:"yy",minDate:"2014-01-01"},b.open=function(a){a.preventDefault(),a.stopPropagation();var c={allocationDate:!1};angular.copy(c,b.datepickers),b.datepickers[a.target.name]=!0},b.shiftMonth=function(a){var c,d,e,f=typeof b.allocationDate,g=b.allocationDate,h=new Date(g);if("string"===f){var i=g.split("-");e=parseInt(i[0]),d=parseInt(i[1])-1,c=parseInt(i[2]),h=new Date(e,d,c)}h.setMonth(h.getMonth()+a),c=h.getDate(),d=h.getMonth()+1,e=h.getFullYear(),10>d&&(d="0"+d),10>c&&(c="0"+c),b.allocationDate=e+"-"+d+"-"+c}}]).directive("manpowerAllocation",function(){return{templateUrl:"views/allocation.html"}}),angular.module("oasApp").controller("SalaryCtrl",["$rootScope","$scope","SalaryService",function(a,b,c){var d=!1;b.salaryService=c,b.salary=c.salary,b.$watch("salaryDate",function(b,c){if(d){if(console.log("salaryDate changed : ",b,c),""===b)return void(b=c);if("object"==typeof b){var e=new Date(b),f=e.getDate(),g=e.getMonth()+1,h=e.getFullYear();10>g&&(g="0"+g),10>f&&(f="0"+f),b=h+"-"+g+"-"+f}a.$broadcast("update_salary")}}),b.$on("update_salary",function(){console.log("update_salary triggered"),b.salaryDate||(b.salaryDate=b.today,d=!0),b.salaryService.getDailySalary(b.salaryDate,b.session.user),b.salaryService.getMonthlySalary(b.salaryDate,b.session.user)}),b.dailyPage=1,b.monthlyPage=1,b.isFirstPage=function(a){return b.isEquals(a,"daily")&&1===b.dailyPage?!0:b.isEquals(a,"monthly")&&1===b.monthlyPage?!0:!1},b.shiftPage=function(c){b.isEquals(b.viewtype,"daily")?(b.dailyPage+=c,a.$broadcast("page_changed",{tab:"daily_salary",page:b.dailyPage,date:b.salaryDate})):(b.monthlyPage+=c,a.$broadcast("page_changed",{tab:"monthly_salary",page:b.monthlyPage,date:b.salaryDate}))},b.viewtype="daily",b.salarymode="live",b.editMode=!1,b.datepickers={salaryDate:!1},b.dateOptions={showWeeks:!1,startingDay:0,formatDay:"dd",formatMonth:"MMMM",formatYear:"yy",minDate:"2014-01-01"},b.open=function(a){console.log(b.settingsService.settings),a.preventDefault(),a.stopPropagation();var c={salaryDate:!1};angular.copy(c,b.datepickers),b.datepickers[a.target.name]=!0},b.shiftDay=function(a){var c,d,e,f=typeof b.salaryDate,g=b.salaryDate,h=new Date(g);if("string"===f){var i=g.split("-");e=parseInt(i[0]),d=parseInt(i[1])-1,c=parseInt(i[2]),h=new Date(e,d,c)}h.setDate(h.getDate()+a),c=h.getDate(),d=h.getMonth()+1,e=h.getFullYear(),10>d&&(d="0"+d),10>c&&(c="0"+c),b.salaryDate=e+"-"+d+"-"+c},b.shiftMonth=function(a){var c,d,e,f=typeof b.salaryDate,g=b.salaryDate,h=new Date(g);if("string"===f){var i=g.split("-");e=parseInt(i[0]),d=parseInt(i[1])-1,c=parseInt(i[2]),h=new Date(e,d,c)}h.setMonth(h.getMonth()+a),c=h.getDate(),d=h.getMonth()+1,e=h.getFullYear(),10>d&&(d="0"+d),10>c&&(c="0"+c),b.salaryDate=e+"-"+d+"-"+c}}]).directive("manpowerSalary",function(){return{templateUrl:"views/salary.html"}}),angular.module("oasApp").controller("AttendanceCtrl",["$rootScope","$scope","$modal","AttendanceService","SettingsService","ProjectsService",function(a,b,c,d){b.attendanceService=d,b.attendanceService.attendances=d.attendances;var e=!1;b.attendancePage=1,b.shiftPage=function(c){b.attendancePage+=c,a.$broadcast("page_changed",{tab:"attendance",page:b.attendancePage,date:b.attendanceDate})},b.$watch("attendanceDate",function(b,c){if(e){if(console.log("attendanceDate changed : ",b,c),""===b)return void(b=c);if("object"==typeof b){var d=new Date(b),f=d.getDate(),g=d.getMonth()+1,h=d.getFullYear();10>g&&(g="0"+g),10>f&&(f="0"+f),b=h+"-"+g+"-"+f}a.$broadcast("update_attendance")}}),b.$on("update_attendance",function(){console.log("update_attendance triggered"),b.attendanceDate||(b.attendanceDate=b.today,e=!0),b.attendanceService.getAttendances(b.attendanceDate,b.session.user),b.selectedEntryId=-1}),b.createEntry=function(a,d,e){var f=c.open({templateUrl:"views/modal/createentry.html",controller:"CreateentryCtrl",backdrop:"static",backdropClass:"backdrop-oas",windowClass:"modal-oas vertical-center attendanceentry-modal",resolve:{modalInfo:function(){return{newEntryDate:b.attendanceDate,employeeId:a,startTime:b.settingsService.settings.work_start_at,projects:b.projectsService.projects}}}});f.result.then(function(a){b.confirmCreateEntry(a,d,e)})},b.confirmCreateEntry=function(d,e,f){var g=c.open({templateUrl:"views/modal/createentryconfirmation.html",controller:"CreateentryconfirmationCtrl",backdrop:"static",backdropClass:"backdrop-oas",size:"sm",windowClass:"modal-oas vertical-center createentryconfirmation-modal",resolve:{modalInfo:function(){return{type:d.type_code,name:e,avatar:f}}}});g.result.then(function(c){c&&b.attendanceService.createAttendance(d,d.employeeId,b.session.user).then(function(c){if(console.log("create attendance done",c),"success"===c.result)return console.log("Success response : ",c),void a.$broadcast("update_attendance");switch(c.status){case 422:console.error("422: ",c.data),b.launchErrorModal(c.data);break;case 401:a.$broadcast("not_authenticated")}})})},b.selectedEntryId=-1,b.defaultAvatarPath="images/manpower/avatar.png",b.setSelectedEntryId=function(a){b.selectedEntryId===a&&(a=-1),b.selectedEntryId=a},b.deleteEntryConfirmation=function(d){var e=c.open({templateUrl:"views/modal/deleteconfirmation.html",controller:"DeleteconfirmationCtrl",backdrop:"static",backdropClass:"backdrop-oas",size:"sm",windowClass:"modal-oas vertical-center deleteconfirmation-modal",resolve:{modalInfo:function(){return{type:"entry"}}}});e.result.then(function(c){c&&b.attendanceService.deleteAttendance(d,b.session.user).then(function(){a.$broadcast("update_attendance",b.attendanceDate)})})},b.editEntry=function(d){var e=c.open({templateUrl:"views/modal/editentry.html",controller:"EditentryCtrl",backdrop:"static",backdropClass:"backdrop-oas",windowClass:"modal-oas vertical-center attendanceentry-modal",resolve:{modalInfo:function(){return{entry:d,entryDate:b.attendanceDate,startTime:b.settingsService.settings.work_start_at,projects:b.projectsService.projects}}}});e.result.then(function(c){b.attendanceService.updateAttendance(c,b.session.user).then(function(){a.$broadcast("update_attendance")})})},b.showEntryDetails=function(a,b){c.open({templateUrl:"views/modal/attendancelocationmodal.html",controller:"AttendancelocationmodalCtrl",backdrop:"static",backdropClass:"backdrop-oas",windowClass:"modal-oas vertical-center attendanceentry-modal",resolve:{modalInfo:function(){return{entry:a,type:b}}}})},b.selectedProject="All projects",b.chooseProject=function(c){b.selectedProject!==c&&a.$broadcast("project_selected_changed"),b.selectedProject=c},b.datepickers={attendanceDate:!1},b.dateOptions={showWeeks:!1,startingDay:0,formatDay:"dd",formatMonth:"MMMM",formatYear:"yy",minDate:"2014-01-01"},b.open=function(a){console.log(b.settingsService.settings),a.preventDefault(),a.stopPropagation();var c={attendanceDate:!1};angular.copy(c,b.datepickers),b.datepickers[a.target.name]=!0},b.shiftDay=function(a){console.log("shiftDay",a);var c,d,e,f=typeof b.attendanceDate,g=b.attendanceDate,h=new Date(g);if("string"===f){var i=g.split("-");e=parseInt(i[0]),d=parseInt(i[1])-1,c=parseInt(i[2]),h=new Date(e,d,c)}h.setDate(h.getDate()+a),c=h.getDate(),d=h.getMonth()+1,e=h.getFullYear(),10>d&&(d="0"+d),10>c&&(c="0"+c),b.attendanceDate=e+"-"+d+"-"+c}}]).directive("manpowerAttendance",function(){return{templateUrl:"views/attendance.html"}}),angular.module("oasApp").controller("SettingsCtrl",["$scope",function(a){a.currentPanel="general",a.setPanel=function(b){a.currentPanel=b}}]).directive("settingsTab",function(){return{templateUrl:"views/settings.html"}}),angular.module("oasApp").controller("GeneralsettingsCtrl",["$rootScope","$scope","SettingsService",function(a,b,c){b.settingsService=c,b.settingsService.settings=c.settings,a.$broadcast("settings_changed"),b.save=function(){console.log("Updating settings"),b.settingsService.updateSettings(b.settingsService.settings,b.session.user).then(function(c){if("success"===c.result)return void a.$broadcast("settings_changed");switch(c.status){case 422:console.error("422: ",c.data),b.launchErrorModal(c.data);break;case 401:a.$broadcast("not_authenticated")}})}}]).directive("settingsGeneral",function(){return{templateUrl:"views/generalsettings.html"}}),angular.module("oasApp").constant("AUTH_EVENTS",{loginSuccess:"auth-login-success",loginFailed:"auth-login-failed",logoutSuccess:"auth-logout-success",sessionTimeout:"auth-session-timeout",notAuthenticated:"auth-not-authenticated",notAuthorized:"auth-not-authorized"}),angular.module("oasApp").constant("USER_ROLES",{all:"*",admin:"admin",user:"user"}),angular.module("oasApp").factory("AuthService",["$http","$location","$cookies","Session","HTTP_PARAMS",function(a,b,c,d,e){var f="";f="mobility.oaspainting.com"===b.host()?e.prodApi:e.devApi;var g={};return g.login=function(b){return console.log("In authservice login"),a({method:"POST",url:f+"sessions",headers:{"X-APP-SECRET":e.appSecret},params:{email:b.email,password:b.password}}).then(function(a){return console.log("res data: ",a.data),a.data})},g.userInfo=function(b,c){return console.log("In authservice userinfo"),a({method:"GET",url:f+"sessions",headers:{"X-USER-ID":b,"X-USER-TOKEN":c}}).then(function(a){return a.data})},g.isAuthenticated=function(){return!!c.authToken},g.isAuthorized=function(a){return angular.isArray(a)||(a=[a]),g.isAuthenticated()&&-1!==a.indexOf(d.userRole)},g}]),angular.module("oasApp").factory("ManpowerService",["$http","$upload","$location","AuthService","HTTP_PARAMS",function(a,b,c,d,e){var f="";f="mobility.oaspainting.com"===c.host()?e.prodApi:e.devApi;var g=function(a){var b={};return b.result="success",b.data=a.data,b},h=function(a){var b={};return b.result="failure",b.status=a.status,b.data=a.data.errors,b},i=function(a){angular.copy(a,j.profiles)},j={};return j.profiles=[],j.profilesArchived=[],j.getProfiles=function(b,e){return console.log("In manpowerService profiles",c.host()),e=void 0===typeof e?1:e,void 0===b&&d.retrieveSession(),a({method:"GET",url:f+"employees",headers:{"X-USER-ID":b.id,"X-USER-TOKEN":b.authToken},params:{page:e}}).then(function(a){i(a.data.employees)})},j.getProfilesArchived=function(b,c){return console.log("In manpowerService getProfilesArchived"),c="undefined"==typeof c?1:c,a({method:"GET",url:f+"employees/archives",headers:{"X-USER-ID":b.id,"X-USER-TOKEN":b.authToken},params:{page:c}}).then(function(a){angular.copy(a.data.employees,j.profilesArchived)})},j.createProfile=function(a,c){var d={};return console.log("In manpowerService.createProfile",a),d={method:"POST",url:f+"employees/",headers:{"X-USER-ID":c.id,"X-USER-TOKEN":c.authToken},data:JSON.parse(angular.toJson(a.formDetails))},0!=a.file.length&&(d.file=a.file[0],d.fileFormDataName="avatar"),b.upload(d).then(g,h)},j.updateProfile=function(a,c){var d={};return console.log("In manpowerService.updateProfile",a),d={method:"PUT",url:f+"employees/"+a.formDetails.id,headers:{"Content-Type":void 0,"X-USER-ID":c.id,"X-USER-TOKEN":c.authToken},data:JSON.parse(angular.toJson(a.formDetails))},0!=a.file.length&&(d.file=a.file[0],d.fileFormDataName="avatar"),b.upload(d).then(g,h)},j.uploadDocument=function(a,c){var d={};return console.log("In manpowerService.uploadDocument",a),d={method:"POST",url:f+"employees/"+a.id+"/employee_files",headers:{"Content-Type":void 0,"X-USER-ID":c.id,"X-USER-TOKEN":c.authToken}},0!=a.file.length&&(d.file=a.file[0],d.fileFormDataName="document"),b.upload(d).then(g,h)},j.deleteDocument=function(b,c){return console.log("In manpowerService.deleteDocument"),a({method:"DELETE",url:f+"employee_files/"+b,headers:{"X-USER-ID":c.id,"X-USER-TOKEN":c.authToken}}).then(g,h)},j.archiveProfile=function(b,c){return console.log("In manpowerService.archiveProfile"),a({method:"POST",url:f+"employees/"+b+"/archive",headers:{"X-USER-ID":c.id,"X-USER-TOKEN":c.authToken}}).then(g,h)},j.unarchiveProfile=function(b,c){return console.log("In manpowerService.unarchiveProfile"),a({method:"POST",url:f+"employees/"+b+"/unarchive",headers:{"X-USER-ID":c.id,"X-USER-TOKEN":c.authToken}}).then(g,h)},j.deleteProfile=function(b,c){return console.log("In manpowerService.deleteProfile"),a({method:"DELETE",url:f+"employees/"+b,headers:{"X-USER-ID":c.id,"X-USER-TOKEN":c.authToken}}).then(g,h)},j}]),angular.module("oasApp").factory("SettingsService",["$rootScope","$http","$location","AuthService","HTTP_PARAMS",function(a,b,c,d,e){var f="";f="mobility.oaspainting.com"===c.host()?e.prodApi:e.devApi;var g=function(a){var b={};return b.result="success",b.data=a.data,b},h=function(a){var b={};return b.result="failure",b.status=a.status,b.data=a.data.errors,b},i={};return i.settings={},i.getSettings=function(c){return console.log("In settingsService.getSettings"),void 0===c&&d.retrieveSession(),b({method:"GET",url:f+"settings",headers:{"X-USER-ID":c.id,"X-USER-TOKEN":c.authToken}}).then(function(b){angular.copy(b.data,i.settings),a.$broadcast("settings_updated")})},i.updateSettings=function(a,c){return console.log("In settingsService.updateSettings"),void 0===c&&d.retrieveSession(),b({method:"POST",url:f+"settings",headers:{"X-USER-ID":c.id,"X-USER-TOKEN":c.authToken},params:a}).then(g,h)},i}]),angular.module("oasApp").controller("PersonalsettingsCtrl",["$scope",function(a){a.name="Employee Name",a.position="Employee Position",a.email="Employee@oas.com",a.password="1234",a.newpassword="",a.confirmpassword=""}]).directive("settingsPersonal",function(){return{templateUrl:"views/personalsettings.html"}}),angular.module("oasApp").controller("AccountsettingsCtrl",["$scope",function(a){a.accounts=[{name:"Employee Name 1",position:"Position 1",email:"1@oas.com",password:"123456",mobilename:"Employee Name",mobilepassword:"123456"},{name:"Employee Name 2",position:"Position 2",email:"2@oas.com",password:"123456",mobilename:"Employee Name",mobilepassword:"123456"},{name:"Employee Name 3",position:"Position 3",email:"3@oas.com",password:"123456",mobilename:"Employee Name",mobilepassword:"123456"}]}]).directive("settingsAccounts",function(){return{templateUrl:"views/accountsettings.html"}}),angular.module("oasApp").controller("ForgotpasswordCtrl",["$scope","$modalInstance",function(a,b){a.email="",a.ok=function(){b.close("")},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("oasApp").controller("GeneralsettingsmodalCtrl",["$rootScope","$scope","$modalInstance","SettingsService",function(a,b,c,d){b.settingsService=d,b.settingsService.settings=d.settings,b.settingsService.getSettings(b.session.user),b.save=function(){console.log("Updating settings"),b.settingsService.updateSettings(b.settingsService.settings,b.session.user).then(function(d){if(console.log("update settings done",d),c.close(""),"success"===d.result)return a.$broadcast("settings_changed"),void c.close("");switch(d.status){case 422:console.error("422: ",d.data),b.launchErrorModal(d.data);break;case 401:a.$broadcast("not_authenticated")}})},b.cancel=function(){c.dismiss("cancel")}}]),angular.module("oasApp").controller("DeleteconfirmationCtrl",["$scope","$modalInstance","modalInfo",function(a,b,c){a.response=!1,a.deletetype=c.type,a.confirm=function(){b.close(!0)},a.cancel=function(){b.dismiss("cancel")}}]).directive("deleteconfirmation",function(){return{templateUrl:"views/modal/deleteconfirmation.html"}}),angular.module("oasApp").directive("matchwith",function(){return{require:"ngModel",scope:{otherValue:"=matchwith"},link:function(a,b,c,d){d.$validators.matchwith=function(b){return b==a.otherValue.$viewValue},a.$watch(a.otherValue,function(){d.$validate()})}}}),angular.module("oasApp").controller("AccountcardCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]).directive("accountCard",function(){return{templateUrl:"views/accountcard.html"}}),angular.module("oasApp").controller("ProfilecardCtrl",["$rootScope","$scope","$filter","$timeout",function(a,b,c,d){b.foreignOptions=[{id:0,name:"Local"},{id:1,name:"Foreigner"}],b.positionOptions=["Supervisor","Asst Supervisor","Worker"],b.nationalityOptions=[{abbrev:"Bgd",name:"Bangladeshi"},{abbrev:"Chn",name:"Chinese"},{abbrev:"Ind",name:"Indian"},{abbrev:"Mmr",name:"Myanmar"},{abbrev:"Mys",name:"Malaysian"},{abbrev:"Sgp",name:"Singaporean"},{abbrev:"Vnm",name:"Vietnamese"},{abbrev:"Other",name:"Other"}],b.editMode=!1,b.employee.date_of_birth=new Date(b.employee.date_of_birth),b.employee.joined_date=new Date(b.employee.joined_date),b.employee.application_date=new Date(b.employee.application_date),b.employee.wp_expired_at=new Date(b.employee.wp_expired_at),b.employee.passport_expired_at=new Date(b.employee.passport_expired_at),b.employee.commence_date=new Date(b.employee.commence_date),b.toggleEdit=function(){b.editMode=!b.editMode},b.saveChanges=function(c){if(!b.profileForm.$valid)return void b.launchErrorModal(["Form invalid.","Please check before submission."]);c.avatar===c.avatar_medium_url&&(c.avatar=null);var d={};d.formDetails=c,d.file=b.selectedImage,b.manpowerService.updateProfile(d,b.session.user).then(function(c){if(console.log("update profile done",c),b.toggleEdit(),"success"===c.result)return void a.$broadcast("update_profiles");switch(c.status){case 500:console.error("500: ",c.data),b.launchErrorModal(["Internal server error"]);break;case 422:console.error("422: ",c.data),b.launchErrorModal(c.data);break;case 401:a.$broadcast("not_authenticated")}})},b.deleteDocument=function(c){b.manpowerService.deleteDocument(c,b.session.user).then(function(){a.$broadcast("update_profiles")})},b.fileReaderSupported=null!=window.FileReader&&(null==window.FileAPI||0!=FileAPI.html5),b.selectedImage=[],b.avatarThumb=null,b.onImageSelect=function(a){b.selectedImage=a},b.$watch("files",function(a){if(b.formUpload=!1,null!=a)for(var c=0;c<a.length;c++)b.errorMsg=null,function(a){b.generateThumb(a)}(a[c])}),b.generateThumb=function(a){null!=a&&b.fileReaderSupported&&a.type.indexOf("image")>-1&&d(function(){var c=new FileReader;c.readAsDataURL(a),c.onload=function(a){d(function(){b.avatarThumb=a.target.result})}})},b.onDocumentSelect=function(c,d){var e={};e.id=d,e.file=c,b.manpowerService.uploadDocument(e,b.session.user).then(function(c){if(console.log("upload document done",c),"success"===c.result)return void a.$broadcast("update_profiles");switch(c.status){case 500:console.error("500: ",c.data),b.launchErrorModal(["Internal server error"]);break;case 422:console.error("422: ",c.data),b.launchErrorModal(c.data);break;case 401:a.$broadcast("not_authenticated")}})}}]).directive("profileCard",function(){return{templateUrl:"views/profilecard.html"}}),angular.module("oasApp").constant("HTTP_PARAMS",{prodApi:"http://api.oaspainting.com/v1/",devApi:"http://54.169.2.173/v1/",appSecret:"992bb2ecb4aca0986c898f19801731d1297220bb857961a0bd2661d5d327c4a2"}),angular.module("oasApp").factory("Session",["$cookies","$cookieStore",function(a,b){var c={};return c.user={},c.create=function(b){var d={id:b.id,name:b.name,avatar:b.avatar_medium_url,avatarThumb:b.avatar_thumb_url,authToken:b.authentication_token};a.user=angular.toJson(d),a.authToken=b.authentication_token,angular.copy(d,c.user)},c.destroy=function(){angular.copy({},c.user),b.remove("userId"),b.remove("user"),b.remove("authToken")},c.restoreSession=function(){var b=angular.fromJson(a.user);angular.copy(b,c.user)},c}]),angular.module("oasApp").controller("SalarycarddailyCtrl",["$rootScope","$scope","$q",function(a,b,c){var d={project_allowance:0,extra_money:1,external_work:2,mc:3,hp:4,safety:5,transport_allowance:6,additional:7},e=function(a){console.log("Processing costType : ",a);var c,e={date:b.salaryDate,cost_type:d[a]};return b.employee[a]?(c=b.employee[a],e.cost=c.cost,c.id?(console.log("Update cost : ",a,e),b.salaryService.updateDailyCost(e,c.id,b.session.user)):(console.log("Create cost : ",a,e),b.salaryService.createDailyCost(e,b.employee.id,b.session.user))):void 0};b.save=function(d){console.log("SAVING SALARY : ",d),c.all([e("project_allowance"),e("extra_money"),e("external_work"),e("mc"),e("hp"),e("safety"),e("transport_allowance"),e("additional")]).then(function(c){console.log(c[0],c[1],c[2],c[3],c[4],c[5],c[6],c[7]),b.editMode=!1,a.$broadcast("update_salary")},function(){b.launchErrorModal(["Error in saving records.","Please try again."]),a.$broadcast("update_salary")})}}]).directive("salaryCardDaily",function(){return{templateUrl:"views/salarycarddaily.html"}}),angular.module("oasApp").controller("SalarycardmonthlyCtrl",["$scope",function(a){a.editMode=!1,a.sixteenDays=["01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16"],a.toggleEdit=function(){a.editMode=!a.editMode},a.records=[];var b=function(b){for(var c,d,e,f=a.employee.dates,g=0;b>g;g++)c=g+1,c=10>c?"0"+c:""+c,a.records[g]={day:c,overtime_hour_count:"-",projects_abbrev_name:"-"};for(var h=0,i=f.length;i>h;h++)e=f[h],d=Number(e.date),a.records[d-1]={day:e.date,overtime_hour_count:e.overtime_hour_count,projects_abbrev_name:e.projects_abbrev_name}};a.$watch("salaryDate",function(c,d){if(console.log("newDate: ",c),""===c)return void(c=d);var e,f;if("object"==typeof c){var g=new Date(c);f=g.getMonth()+1,e=g.getFullYear(),10>f&&(f="0"+f),c=e+"-"+f}e=c.substring(0,4),f=c.substring(5,7);for(var h=new Date(e,f,0).getDate(),i=[],j=0,k=h-16;k>j;j++)i.push(j+17);a.remainingDaysInMonth=i,b(h)})}]).directive("salaryCardMonthly",function(){return{templateUrl:"views/salarycardmonthly.html"}}),angular.module("oasApp").controller("alphabetListCtrl",["$scope",function(a){a.active="A"}]).directive("alphabetList",function(){return{templateUrl:"views/alphabetlist.html",restrict:"EA"}}),angular.module("oasApp").filter("nulldash",function(){return function(a){return null==a||void 0===a?"-":a}}),angular.module("oasApp").controller("NewprofileCtrl",["$rootScope","$scope","$modal","$timeout",function(a,b,c,d){var e=function(){b.newEmployee={name:"New Employee",avatar:null,avatar_medium_url:null,login_id:null,passcode:null,dormitory_address:null,nationality:null,foreign:0,date_of_birth:null,position:"Worker",joined_date:null,work_permit_number:null,application_date:null,commence_date:null,employment_period:null,fin:null,wp_expired_at:null,passport:null,passport_expired_at:null,skill_passed:null,passed_date:null,soc_details:null,soc_expired_at:null,additional_qualification:null,others:null,basic_rate:null,skill_rate:null,overtime_rate:null,levy_rate:null,meal_allowance:null,employee_files:null}};e(),b.$watch("newProfile",function(){e()}),b.foreignOptions=[{id:0,name:"Local"},{id:1,name:"Foreigner"}],b.positionOptions=["Supervisor","Asst Supervisor","Worker"],b.nationalityOptions=[{abbrev:"Bgd",name:"Bangladeshi"},{abbrev:"Chn",name:"Chinese"},{abbrev:"Ind",name:"Indian"},{abbrev:"Mmr",name:"Myanmar"},{abbrev:"Mys",name:"Malaysian"},{abbrev:"Sgp",name:"Singaporean"},{abbrev:"Vnm",name:"Vietnamese"},{abbrev:"Other",name:"Other"}],b.createEmployee=function(){if(!b.profileForm.$valid)return void b.launchErrorModal(["Form invalid. Please check before submission."]);var c={};c.formDetails=b.newEmployee,c.file=b.selectedFile,b.manpowerService.createProfile(c,b.session.user).then(function(c){if(console.log("create profile done",c),"success"===c.result)return e(),void a.$broadcast("update_profiles");switch(c.status){case 422:console.error("422: ",c.data),b.launchErrorModal(c.data);break;case 401:a.$broadcast("not_authenticated")}})},b.fileReaderSupported=null!=window.FileReader&&(null==window.FileAPI||0!=FileAPI.html5),b.selectedFile=[],b.avatarThumb="",b.onFileSelect=function(a){b.selectedFile=a},b.$watch("files",function(a){if(b.formUpload=!1,null!=a)for(var c=0;c<a.length;c++)b.errorMsg=null,function(a){b.generateThumb(a)}(a[c])}),b.generateThumb=function(a){null!=a&&b.fileReaderSupported&&a.type.indexOf("image")>-1&&d(function(){var c=new FileReader;c.readAsDataURL(a),c.onload=function(a){d(function(){b.avatarThumb=a.target.result})}})}}]).directive("newprofileCard",function(){return{templateUrl:"views/newprofilecard.html"}}),angular.module("oasApp").filter("isforeigner",function(){return function(a){return 1===a?"Foreigner":"Local"}}),angular.module("oasApp").factory("AttendanceService",["$http","$location","AuthService","HTTP_PARAMS",function(a,b,c,d){var e="";e="mobility.oaspainting.com"===b.host()?d.prodApi:d.devApi;var f=function(a){var b={};return b.result="success",b.data=a.data,b},g=function(a){var b={};return b.result="failure",b.status=a.status,b.data=a.data.errors,b},h=function(a){var b=["00:00","01:00","02:00","03:00","04:00","05:00","06:00","07:00","08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00","22:00","23:00"],c=Number(a[0]+a[1]),d=b.slice(0,c),e=b.slice(c),f=e.concat(d);return f.concat([a])},i=function(a,b){var c,d,e,f=a.map(function(a){return 2!==a.type_code&&3!==a.type_code&&4!==a.type_code?null===a.check_out_time?void(a.type_code=0):(c=Number(a.check_out_time.slice(11,13)),d=Number(a.check_out_time.slice(14,16)),e=60*(60*c+d)*1e3,b>e&&(e+=864e5),e):void 0});return f.unshift(b),f.sort(function(a,b){return a-b}),f},j=function(a,b,c,d,e,f){var g,h,i,j,k,l,m,n,o,p,q,r=0,s="";switch(b.type_code){case 1:for(k=Number(b.check_out_time.slice(11,13)),l=Number(b.check_out_time.slice(14,16)),m=60*(60*k+l)*1e3,h=Number(b.check_in_time.slice(11,13)),i=Number(b.check_in_time.slice(14,16)),j=60*(60*h+i)*1e3,d>j&&(j+=864e5),d>m&&(m+=864e5),n=(m-j)/864e3,r=c.length;r>0;)r--,c[r]<=j&&(o=(j-c[r])/864e3,r=0),1===r&&j>=f&&(s="late ");
s+=1===b.incomplete?"attendance-entry red-bar":j>=e?"attendance-entry yellow-bar":"attendance-entry blue-bar";break;case 5:for(k=Number(b.check_out_time.slice(11,13)),l=Number(b.check_out_time.slice(14,16)),m=60*(60*k+l)*1e3,h=Number(b.check_in_time.slice(11,13)),i=Number(b.check_in_time.slice(14,16)),j=60*(60*h+i)*1e3,d>j&&(j+=864e5),d>m&&(m+=864e5),n=(m-j)/864e3,r=c.length;r>0;)r--,c[r]<=j&&(o=(j-c[r])/864e3,r=0),1===r&&j>=f&&(s="late ");s="attendance-entry dark-blue-bar";break;case 2:n=100,o=0,s="attendance-entry green-bar";break;case 3:n=100,o=0,s="attendance-entry green-bar";break;case 4:n=100,o=0,s="attendance-entry purple-bar";break;default:for(h=Number(b.check_in_time.slice(11,13)),i=Number(b.check_in_time.slice(14,16)),j=60*(60*h+i)*1e3,g=864e5-j+c[0],n=g/864e3,r=c.length;r>0;)r--,c[r]<=j&&(o=(j-c[r])/864e3,r=0);s="attendance-entry red-bar"}return p=(j-c[0])/864e3,q="attendance-info left",p>50&&(p-=45,q="attendance-info right"),n+="%",o+="%",p+="%",{entryWidth:n,leftMargin:o,wallMargin:p,infoClasses:q,classes:s}},k=function(a){var b=a.check_in_start_at,c=b.split(":"),d=Number(c[0]),e=Number(c[1]),f=60*(60*d+e)*1e3,g=a.overtime_at,k=g.split(":"),m=Number(k[0]),n=Number(k[1]),o=60*(60*m+n)*1e3,p=a.late_after,q=p.split(":"),r=Number(q[0]),s=Number(q[1]),t=60*(60*r+s)*1e3;a.timeline=h(b),a.employees.map(function(a){var b=a.attendances,c=i(b,f);return b.map(function(a,b){return a.styles=j(b,a,c,f,o,t),a}),a.checkoutArr=c,a}),console.log("data : ",a),angular.copy(a,l.attendances)},l={attendances:[]};return l.getAttendances=function(b,d,f){return console.log("In attendanceService.getAttendances",b),void 0===d&&c.retrieveSession(),f=void 0===typeof f?1:f,a({method:"GET",url:e+"attendances/"+b+"/?page=1",headers:{"X-USER-ID":d.id,"X-USER-TOKEN":d.authToken},params:{page:f}}).then(function(a){k(a.data)})},l.createAttendance=function(b,d,h){return console.log("In attendanceService.createAttendance"),void 0===h&&c.retrieveSession(),a({method:"POST",url:e+"employees/"+d+"/attendances",headers:{"X-USER-ID":h.id,"X-USER-TOKEN":h.authToken},params:b}).then(f,g)},l.updateAttendance=function(b,c){return console.log("In attendanceService.updateAttendance"),a({method:"PUT",url:e+"attendances/"+b.id,headers:{"X-USER-ID":c.id,"X-USER-TOKEN":c.authToken},params:b}).then(f,g)},l.deleteAttendance=function(b,c){return console.log("In attendanceService.deleteAttendance"),a({method:"DELETE",url:e+"attendances/"+b,headers:{"X-USER-ID":c.id,"X-USER-TOKEN":c.authToken}}).then(f,g)},l.getEmployeeAttendance=function(b,d){return console.log("In attendanceService getEmployeeAttendance"),void 0===d&&c.retrieveSession(),a({method:"GET",url:e+"employees/"+b+"/attendances",headers:{"X-USER-ID":d.id,"X-USER-TOKEN":d.authToken},params:{page:1}}).then(f,g)},l}]),angular.module("oasApp").controller("AttendancecardCtrl",["$rootScope","$scope",function(a,b){b.entries=b.employee.attendances.reverse()}]).directive("attendanceCard",function(){return{templateUrl:"views/attendancecard.html"}}),angular.module("oasApp").controller("AttendanceentryCtrl",["$scope",function(a){a.$watch("selectedEntryId",function(){a.active=a.isEquals(a.selectedEntryId,a.entry.id)?"active":""}),a.$watch("selectedProject",function(b){a.setSelectedEntryId(-1),a.disabled=a.isEquals(b,a.entry.project.name)||"All projects"===b?"":"disabled"})}]).directive("attendanceEntry",function(){return{templateUrl:"views/attendanceentry.html"}}),angular.module("oasApp").controller("CreateentryCtrl",["$scope","$filter","$modalInstance","modalInfo",function(a,b,c,d){var e=["PROJECT","LEAVE","MEDICAL LEAVE","PUBLIC HOLIDAY"];a.ok=function(){var b=e.indexOf(a.selectedEntryType)+1,f=a.selectedProjectId,g=new Date(d.newEntryDate),h={},i=d.startTime,j=i.split(":"),k=Number(j[0]),l=Number(j[1]),m=g.setHours(k,l,0,0);if(a.errorMessage="",""===b||""===f)return void(a.errorMessage="All fields are required.");if(1===b&&(""===n||""===s))return void(a.errorMessage="All fields are required.");if(h.project_id=f,h.type_code=b,h.employeeId=d.employeeId,1===b){var g=new Date(d.newEntryDate),n=a.checkinTime,o=n.split(":"),p=Number(o[0]),q=Number(o[1]),r=g.setHours(p,q,0,0),s=a.checkoutTime,t=s.split(":"),u=Number(t[0]),v=Number(t[1]),w=g.setHours(u,v,0,0);m>r&&(r+=864e5),m>w&&(w+=864e5);var x=new Date(r),y=new Date(w);h.check_in_time=x.toISOString(),h.check_out_time=y.toISOString()}(2===b||3===b||4===b)&&(g.setHours(k,l,0,0),h.check_in_time=g.toISOString(),h.remark=a.entryRemarks),console.log("newEntryParams : ",h),c.close(h)},a.cancel=function(){c.dismiss("cancel")},a.isSelectedEntryType=function(b){return e.indexOf(a.selectedEntryType)===b-1},a.chooseEntryType=function(b){a.selectedEntryType=e[b-1]},a.chooseProject=function(c){var d={};a.selectedProjectId=c,d=b("filter")(a.projects,{id:c})[0],a.selectedProjectName=d.name,a.selectedProjectAddress=d.address},a.projects=d.projects,a.selectedEntryType="",a.selectedProjectId="",a.selectedProjectName="",a.selectedProjectAddress="",a.entryRemarks="",a.errorMessage="",a.status={isopen:!1},a.toggleDropdown=function(b){b.preventDefault(),b.stopPropagation(),a.status.isopen=!a.status.isopen}}]),angular.module("oasApp").factory("ProjectsService",["$http","$location","AuthService","HTTP_PARAMS",function(a,b,c,d){var e="";e="mobility.oaspainting.com"===b.host()?d.prodApi:d.devApi;var f={};return f.projects=[],f.getProjects=function(b){return console.log("In projectsService.getProjects"),void 0===b&&c.retrieveSession(),a({method:"GET",url:e+"projects",headers:{"X-USER-ID":b.id,"X-USER-TOKEN":b.authToken}}).then(function(a){angular.copy(a.data.projects,f.projects)})},f}]),angular.module("oasApp").controller("CreateentryconfirmationCtrl",["$scope","$modalInstance","modalInfo",function(a,b,c){a.modalInfo=c,a.isEntryType=function(a){return c.type===a},a.confirm=function(){b.close(!0)},a.cancel=function(){b.dismiss("cancel")}}]).directive("createentryconfirmation",function(){return{templateUrl:"views/modal/createentryconfirmation.html"}}),angular.module("oasApp").controller("AttendanceinfoCtrl",["$rootScope","$scope",function(a,b){b.entryIncomplete=1===b.entry.incomplete,b.confirmEntry=function(){console.log("Confirm entry"),b.entry.incomplete=0,b.attendanceService.updateAttendance(b.entry,b.session.user).then(function(){a.$broadcast("update_attendance")})}}]).directive("attendanceInfo",function(){return{templateUrl:"views/attendanceinfo.html"}}),angular.module("oasApp").controller("EditentryCtrl",["$scope","$filter","$modalInstance","modalInfo",function(a,b,c,d){console.log("modalinfo",d);var e=["PROJECT","LEAVE","MEDICAL LEAVE","PUBLIC HOLIDAY"];a.ok=function(){var b=e.indexOf(a.selectedEntryType)+1,f=a.selectedProjectId,g=new Date(d.entryDate),h={},i=d.startTime,j=i.split(":"),k=Number(j[0]),l=Number(j[1]),m=g.setHours(k,l,0,0);if(a.errorMessage="",""===b||""===f)return void(a.errorMessage="All fields are required.");if(1===b&&(""===n||""===s))return void(a.errorMessage="All fields are required.");if(h.project_id=f,h.type_code=b,h.id=d.entry.id,1===b){var g=new Date(d.entryDate),n=a.checkinTime,o=n.split(":"),p=Number(o[0]),q=Number(o[1]),r=g.setHours(p,q,0,0),s=a.checkoutTime,t=s.split(":"),u=Number(t[0]),v=Number(t[1]),w=g.setHours(u,v,0,0);m>r&&(r+=864e5),m>w&&(w+=864e5);var x=new Date(r),y=new Date(w);h.check_in_time=x.toISOString(),h.check_out_time=y.toISOString()}(2===b||3===b||4===b)&&(g.setHours(k,l,0,0),h.check_in_time=g.toISOString(),h.remark=a.entryRemarks),console.log("edit entryParams : ",h),c.close(h)},a.cancel=function(){c.dismiss("cancel")},a.isSelectedEntryType=function(b){return e.indexOf(a.selectedEntryType)===b-1},a.chooseEntryType=function(b){a.selectedEntryType=e[b-1]},a.chooseProject=function(c){var d={};a.selectedProjectId=c,d=b("filter")(a.projects,{id:c})[0],a.selectedProjectName=d.name,a.selectedProjectAddress=d.address},a.projects=d.projects,a.selectedEntryType="",a.selectedProjectId="",a.selectedProjectName="",a.selectedProjectAddress="",a.entryRemarks="",a.errorMessage="",a.checkinTime="",a.checkoutTime="",a.chooseProject(d.entry.project.id),a.chooseEntryType(d.entry.type_code),a.checkinTime=b("date")(d.entry.check_in_time,"HH:mm"),a.checkoutTime=b("date")(d.entry.check_out_time,"HH:mm"),a.status={isopen:!1},a.toggleDropdown=function(b){b.preventDefault(),b.stopPropagation(),a.status.isopen=!a.status.isopen}}]),angular.module("oasApp").factory("SalaryService",["$http","$location","AuthService","HTTP_PARAMS",function(a,b,c,d){var e="";e="mobility.oaspainting.com"===b.host()?d.prodApi:d.devApi;var f=function(a){var b={};return b.result="success",b.data=a.data,b},g=function(a){var b={};return b.result="failure",b.status=a.status,b.data=a.data.errors,b},h=function(a){angular.copy(a,i.salary.daily)},i={};return i.salary={daily:[],monthly:[]},i.getDailySalary=function(b,d,f){return console.log("In salaryService.getDailySalary",b),void 0===d&&c.retrieveSession(),f=void 0===typeof f?1:f,a({method:"GET",url:e+"daily_salaries/",headers:{"X-USER-ID":d.id,"X-USER-TOKEN":d.authToken},params:{date:b,page:f}}).then(function(a){h(a.data.employees)})},i.createDailyCost=function(b,d,h){return console.log("In salaryService.createDailyCost"),void 0===h&&c.retrieveSession(),a({method:"POST",url:e+"employees/"+d+"/daily_costs",headers:{"X-USER-ID":h.id,"X-USER-TOKEN":h.authToken},params:b}).then(f,g)},i.updateDailyCost=function(b,d,h){return console.log("In salaryService.updateDailyCost"),void 0===h&&c.retrieveSession(),a({method:"PUT",url:e+"daily_costs/"+d,headers:{"X-USER-ID":h.id,"X-USER-TOKEN":h.authToken},params:b}).then(f,g)},i.getMonthlySalary=function(b,d,f){return console.log("In salaryService.getMonthlySalary",b),void 0===d&&c.retrieveSession(),f=void 0===typeof f?1:f,a({method:"GET",url:e+"monthly_salaries/",headers:{"X-USER-ID":d.id,"X-USER-TOKEN":d.authToken},params:{month:b,page:f}}).then(function(a){angular.copy(a.data.employees,i.salary.monthly)})},i}]),angular.module("oasApp").filter("nullzero",function(){return function(a){return null==a||void 0===a?0:a}}),angular.module("oasApp").controller("ErrormodalCtrl",["$scope","$modalInstance","modalInfo",function(a,b,c){a.errors=c.errors,a.cancel=function(){b.dismiss("cancel")}}]).directive("errormodal",function(){return{templateUrl:"views/modal/errormodal.html"}}),angular.module("oasApp").controller("AttendancecalendarmodalCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("oasApp").controller("AttendancelocationmodalCtrl",["$scope","$modalInstance","modalInfo","BingMapsService",function(a,b,c,d){var e,f;a.entry=c.entry,a.isCheckIn="checkin"===c.type,a.bingMapsService=d,a.isCheckIn?(e=a.entry.check_in_latitude,f=a.entry.check_in_longitude):(e=a.entry.check_out_latitude,f=a.entry.check_out_longitude),a.mapImage=a.bingMapsService.getMap(e,f),a.cancel=function(){b.dismiss("cancel")}}]);var CURRENCY_REGEXP=/^\d+(\.\d{1,2})?$/;angular.module("oasApp").directive("currency",function(){return{require:"ngModel",link:function(a,b,c,d){d.$validators.currency=function(a,b){return d.$isEmpty(b)?!0:CURRENCY_REGEXP.test(b)?!0:!1}}}}).directive("supervisorRequired",function(){return{require:"ngModel",link:function(a,b,c,d){d.$validators.supervisorRequired=function(a,b){console.log("checking supervisor-required",c.position);var e=c.position;return"Worker"===e?!0:d.$isEmpty(b)?!1:!0}}}}).directive("earlierThan",function(){return{require:"ngModel",link:function(a,b,c,d){d.$validators.earlierThan=function(a,b){if(d.$isEmpty(b))return!0;if(!c.datelimit)return!0;var e=c.datelimit,f=Date.parse(b);return"today"===e?(e=new Date,e=Date.parse(e)):e=Date.parse(e.substring(1,20)),f>e?!1:!0}}}}).directive("laterThan",function(){return{require:"ngModel",link:function(a,b,c,d){d.$validators.laterThan=function(a,b){if(d.$isEmpty(b))return!0;if(!c.datefloor)return!0;var e=c.datefloor,f=Date.parse(b);return"today"===e?(e=new Date,e=Date.parse(e)):e=Date.parse(e.substring(1,20)),e>f?!1:!0}}}}),angular.module("oasApp").factory("BingMapsService",["$http",function(){var a="http://dev.virtualearth.net/REST/v1/Imagery/Map/Road?",b="AkpMfMQZehVe_Q6Huq9R_mW3NV-17qlBZturl2ysWAgxZKclRFiUZGm1fgy9FJNl",c=20,d="600,300",e={};return e.getMap=function(e,f){return a+"key="+b+"&centerPoint="+e+","+f+"&pp="+e+","+f+";65&mapSize="+d+"&zoomLevel="+c},e}]),angular.module("oasApp").factory("AllocationService",["$rootScope","$http","$location","AuthService","HTTP_PARAMS",function(a,b,c,d,e){var f="mobility.oaspainting.com"===c.host()?e.prodApi:e.devApi,g={},h=function(a,b){var c=a.nationalities,d=a.projects,e=a.allocations,f=[],g={},h={},i=0,j=0;d.map(function(a){a.total=[],c.map(function(b){a[b]=[]}),g[a.id]=a}),e.map(function(a){f.push(a.date.substr(8))}),e.map(function(a){var b=a.projects;b.map(function(a){j=0,c.map(function(b){i=a.nationalities[b]?a.nationalities[b]:0,j+=i,g[a.id][b].push(i)}),g[a.id].total.push(j)})}),h.nationalities=c,h.nationalitiesCount=c.length,h.dates=f,h.data=g,angular.copy(h,b)};return g.allocations={normal:{},overtime:{}},g.getNormalAllocations=function(a,c){return console.log("In allocationService.getNormalAllocations"),void 0===c&&d.retrieveSession(),b({method:"GET",url:f+"allocations",headers:{"X-USER-ID":c.id,"X-USER-TOKEN":c.authToken},params:{month:a,type:0}}).then(function(a){h(a.data,g.allocations.normal)})},g.getOvertimeAllocations=function(a,c){return console.log("In allocationService.getOvertimeAllocations"),void 0===c&&d.retrieveSession(),b({method:"GET",url:f+"allocations",headers:{"X-USER-ID":c.id,"X-USER-TOKEN":c.authToken},params:{month:a,type:1}}).then(function(a){h(a.data,g.allocations.overtime)})},g}]),angular.module("oasApp").directive("dateInput",["dateFilter",function(a){return{require:"ngModel",template:'<input type="date"></input>',replace:!0,link:function(b,c,d,e){e.$formatters.unshift(function(b){return a(b,"yyyy-MM-dd")}),e.$parsers.unshift(function(a){return new Date(a)})}}}]);